define("block_modulelibrary/modulelibrary",["jquery","core/ajax","core/templates","core/notification"],(function($,ajax,templates,notification){let selectedModule=null,currentCourseId=0;return{init:function(opts){currentCourseId=(opts=opts||{}).currentCourseId||0,$(document).on("change","#modulelibrary-course-select",(function(){const courseId=$(this).val();courseId?function(courseId){$("#modulelibrary-loading").show(),$("#modulelibrary-modules").empty(),$("#modulelibrary-copy-form").empty(),ajax.call([{methodname:"block_modulelibrary_get_template_course_modules",args:{courseid:parseInt(courseId,10)}}])[0].done((function(response){var _data$sections;$("#modulelibrary-loading").hide();const data=response;if(!data||null===(_data$sections=data.sections)||void 0===_data$sections||!_data$sections.length)return void $("#modulelibrary-modules").html("<p>No modules found in this course.</p>");let html="<h4>"+data.title+"</h4>";data.sections.forEach((function(section){html+="<h5>Section "+section.section+" - "+(section.name||"")+"</h5><ul>",section.modules.forEach((function(m){html+="<li>"+m.modname+": "+m.name+' <button type="button" class="select-template-module-btn" data-cmid="'+m.cmid+'" data-name="'+m.name+'">Copy this module</button></li>'})),html+="</ul>"})),$("#modulelibrary-modules").html(html)})).fail((function(err){$("#modulelibrary-loading").hide(),notification.exception(err)}))}(courseId):($("#modulelibrary-modules").empty(),$("#modulelibrary-copy-form").empty())})),$(document).on("click",".select-template-module-btn",(function(){selectedModule={cmid:$(this).data("cmid"),name:$(this).data("name")},selectedModule&&($("#modulelibrary-copy-form").html("<p>Loading target sections...</p>"),ajax.call([{methodname:"block_modulelibrary_get_target_course_sections",args:{courseid:currentCourseId}}])[0].done((function(sections){const data={modulename:selectedModule.name,sections:sections};templates.render("block_modulelibrary/copy_form",data).then((function(html,js){$("#modulelibrary-copy-form").html(html),templates.runTemplateJS(js)})).fail((function(err){$("#modulelibrary-copy-form").html("<p>Failed to render form</p>"),notification.exception(err)}))})).fail((function(err){$("#modulelibrary-copy-form").html("<p>Failed to load target sections</p>"),notification.exception(err)})))})),$(document).on("submit","#copy-assessment-form",(function(e){e.preventDefault(),function(){if(!selectedModule)return void notification.exception(new Error("No template module selected"));const targetsection=parseInt($("#target-section").val()||0,10);ajax.call([{methodname:"block_modulelibrary_copy_activity",args:{cmid:parseInt(selectedModule.cmid,10),targetcourseid:currentCourseId,targetsection:targetsection}}])[0].done((function(response){response.status?(notification.addNotification({message:"Module copied successfully",type:"success"}),setTimeout((function(){window.location.reload()}),1200)):notification.exception(new Error("Copy failed"))})).fail((function(err){notification.exception(err)}))}()})),$(document).on("click","#cancel-copy-btn",(function(){selectedModule=null,$("#modulelibrary-copy-form").empty()}))}}}));

//# sourceMappingURL=modulelibrary.min.js.map