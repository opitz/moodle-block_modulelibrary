{"version":3,"file":"modulelibrary.min.js","sources":["../src/modulelibrary.js"],"sourcesContent":["/**\n * AMD module for block_modulelibrary\n * @module block_modulelibrary/modulelibrary\n */\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/notification'],\n    function($, ajax, templates, notification) {\n\n    /**\n     * Selected template module\n     * @type {{cmid: number, name: string}|null}\n     */\n    let selectedModule = null;\n\n    /** @type {number} Current course id */\n    let currentCourseId = 0;\n\n    /**\n     * Initializes the Module Library JS.\n     * @param {Object} opts\n     */\n    const init = function(opts) {\n        opts = opts || {};\n        currentCourseId = opts.currentCourseId || 0;\n        bindEvents();\n    };\n\n    /**\n     * Bind all events for the module library UI\n     */\n    function bindEvents() {\n        // When selecting a template course.\n        $(document).on('change', '#modulelibrary-course-select', function() {\n            const courseId = $(this).val();\n            if (courseId) {\n                loadTemplateCourseSections(courseId);\n            } else {\n                $('#modulelibrary-modules').empty();\n                $('#modulelibrary-copy-form').empty();\n            }\n        });\n\n        // When clicking \"Copy this module\".\n        $(document).on('click', '.select-template-module-btn', function() {\n            selectedModule = { cmid: $(this).data('cmid'), name: $(this).data('name') };\n            showCopyForm();\n        });\n\n        // Handle copy confirmation.\n        $(document).on('submit', '#copy-assessment-form', function(e) {\n            e.preventDefault();\n            doCopy();\n        });\n\n        // Cancel copy.\n        $(document).on('click', '#cancel-copy-btn', function() {\n            selectedModule = null;\n            $('#modulelibrary-copy-form').empty();\n        });\n    }\n\n    /**\n     * Load sections and modules from the template course.\n     * @param {number} courseId\n     */\n    function loadTemplateCourseSections(courseId) {\n        $('#modulelibrary-loading').show();\n        $('#modulelibrary-modules').empty();\n        $('#modulelibrary-copy-form').empty();\n\n        ajax.call([{\n            methodname: 'block_modulelibrary_get_template_course_modules',\n            args: { courseid: parseInt(courseId, 10) }\n        }])[0].done(function(response) {\n            $('#modulelibrary-loading').hide();\n            const data = response;\n            if (!data || !data.sections?.length) {\n                $('#modulelibrary-modules').html('<p>No modules found in this course.</p>');\n                return;\n            }\n            let html = '<h4>' + data.title + '</h4>';\n            data.sections.forEach(function(section) {\n                html += '<h5>Section ' + section.section + ' - ' + (section.name || '') + '</h5><ul>';\n                section.modules.forEach(function(m) {\n                    html += '<li>' + m.modname + ': ' + m.name +\n                        ' <button type=\"button\" class=\"select-template-module-btn\" data-cmid=\"' + m.cmid +\n                        '\" data-name=\"' + m.name + '\">Copy this module</button>' + '</li>';\n                });\n                html += '</ul>';\n            });\n            $('#modulelibrary-modules').html(html);\n        }).fail(function(err) {\n            $('#modulelibrary-loading').hide();\n            notification.exception(err);\n        });\n    }\n\n    /**\n     * Show copy form for selected template module\n     */\n    function showCopyForm() {\n        if (!selectedModule) {\n            return;\n        }\n\n        $('#modulelibrary-copy-form').html('<p>Loading target sections...</p>');\n\n        ajax.call([{\n            methodname: 'block_modulelibrary_get_target_course_sections',\n            args: { courseid: currentCourseId }\n        }])[0].done(function(sections) {\n            // Data to pass to the Mustache template\n            const data = {\n                modulename: selectedModule.name,\n                sections: sections\n            };\n\n            templates.render('block_modulelibrary/copy_form', data)\n                .then(function(html, js) {\n                    $('#modulelibrary-copy-form').html(html);\n                    templates.runTemplateJS(js);\n                })\n                .fail(function(err) {\n                    $('#modulelibrary-copy-form').html('<p>Failed to render form</p>');\n                    notification.exception(err);\n                });\n\n        }).fail(function(err) {\n            $('#modulelibrary-copy-form').html('<p>Failed to load target sections</p>');\n            notification.exception(err);\n        });\n    }\n\n    /**\n     * Perform copy of selected template module\n     */\n    function doCopy() {\n        if (!selectedModule) {\n            notification.exception(new Error('No template module selected'));\n            return;\n        }\n        const targetsection = parseInt($('#target-section').val() || 0, 10);\n\n        ajax.call([{\n            methodname: 'block_modulelibrary_copy_activity',\n            args: {\n                cmid: parseInt(selectedModule.cmid, 10),\n                targetcourseid: currentCourseId,\n                targetsection: targetsection\n            }\n        }])[0].done(function(response) {\n            if (response.status) {\n                notification.addNotification({message: 'Module copied successfully', type: 'success'});\n                setTimeout(function() { window.location.reload(); }, 1200);\n            } else {\n                notification.exception(new Error('Copy failed'));\n            }\n        }).fail(function(err) {\n            notification.exception(err);\n        });\n    }\n\n    return { init: init };\n});\n"],"names":["define","$","ajax","templates","notification","selectedModule","currentCourseId","init","opts","document","on","courseId","this","val","show","empty","call","methodname","args","courseid","parseInt","done","response","hide","data","sections","_data$sections","length","html","title","forEach","section","name","modules","m","modname","cmid","fail","err","exception","loadTemplateCourseSections","modulename","render","then","js","runTemplateJS","e","preventDefault","Error","targetsection","targetcourseid","status","addNotification","message","type","setTimeout","window","location","reload","doCopy"],"mappings":"AAIAA,2CAAO,CAAC,SAAU,YAAa,iBAAkB,sBAC7C,SAASC,EAAGC,KAAMC,UAAWC,kBAMzBC,eAAiB,KAGjBC,gBAAkB,QAmJf,CAAEC,KA7II,SAASC,MAElBF,iBADAE,KAAOA,MAAQ,IACQF,iBAAmB,EAS1CL,EAAEQ,UAAUC,GAAG,SAAU,gCAAgC,iBAC/CC,SAAWV,EAAEW,MAAMC,MACrBF,kBA+BwBA,UAChCV,EAAE,0BAA0Ba,OAC5Bb,EAAE,0BAA0Bc,QAC5Bd,EAAE,4BAA4Bc,QAE9Bb,KAAKc,KAAK,CAAC,CACPC,WAAY,kDACZC,KAAM,CAAEC,SAAUC,SAAST,SAAU,QACrC,GAAGU,MAAK,SAASC,6BACjBrB,EAAE,0BAA0BsB,aACtBC,KAAOF,aACRE,6BAASA,KAAKC,qCAALC,eAAeC,mBACzB1B,EAAE,0BAA0B2B,KAAK,+CAGjCA,KAAO,OAASJ,KAAKK,MAAQ,QACjCL,KAAKC,SAASK,SAAQ,SAASC,SAC3BH,MAAQ,eAAiBG,QAAQA,QAAU,OAASA,QAAQC,MAAQ,IAAM,YAC1ED,QAAQE,QAAQH,SAAQ,SAASI,GAC7BN,MAAQ,OAASM,EAAEC,QAAU,KAAOD,EAAEF,KAClC,wEAA0EE,EAAEE,KAC5E,gBAAkBF,EAAEF,KAFhB,sCAIZJ,MAAQ,WAEZ3B,EAAE,0BAA0B2B,KAAKA,SAClCS,MAAK,SAASC,KACbrC,EAAE,0BAA0BsB,OAC5BnB,aAAamC,UAAUD,QA1DnBE,CAA2B7B,WAE3BV,EAAE,0BAA0Bc,QAC5Bd,EAAE,4BAA4Bc,YAKtCd,EAAEQ,UAAUC,GAAG,QAAS,+BAA+B,WACnDL,eAAiB,CAAE+B,KAAMnC,EAAEW,MAAMY,KAAK,QAASQ,KAAM/B,EAAEW,MAAMY,KAAK,SAyDjEnB,iBAILJ,EAAE,4BAA4B2B,KAAK,qCAEnC1B,KAAKc,KAAK,CAAC,CACPC,WAAY,iDACZC,KAAM,CAAEC,SAAUb,oBAClB,GAAGe,MAAK,SAASI,gBAEXD,KAAO,CACTiB,WAAYpC,eAAe2B,KAC3BP,SAAUA,UAGdtB,UAAUuC,OAAO,gCAAiClB,MAC7CmB,MAAK,SAASf,KAAMgB,IACjB3C,EAAE,4BAA4B2B,KAAKA,MACnCzB,UAAU0C,cAAcD,OAE3BP,MAAK,SAASC,KACXrC,EAAE,4BAA4B2B,KAAK,gCACnCxB,aAAamC,UAAUD,WAGhCD,MAAK,SAASC,KACbrC,EAAE,4BAA4B2B,KAAK,yCACnCxB,aAAamC,UAAUD,YAhF3BrC,EAAEQ,UAAUC,GAAG,SAAU,yBAAyB,SAASoC,GACvDA,EAAEC,gCAuFD1C,2BACDD,aAAamC,UAAU,IAAIS,MAAM,sCAG/BC,cAAgB7B,SAASnB,EAAE,mBAAmBY,OAAS,EAAG,IAEhEX,KAAKc,KAAK,CAAC,CACPC,WAAY,oCACZC,KAAM,CACFkB,KAAMhB,SAASf,eAAe+B,KAAM,IACpCc,eAAgB5C,gBAChB2C,cAAeA,kBAEnB,GAAG5B,MAAK,SAASC,UACbA,SAAS6B,QACT/C,aAAagD,gBAAgB,CAACC,QAAS,6BAA8BC,KAAM,YAC3EC,YAAW,WAAaC,OAAOC,SAASC,WAAa,OAErDtD,aAAamC,UAAU,IAAIS,MAAM,mBAEtCX,MAAK,SAASC,KACblC,aAAamC,UAAUD,QA3GvBqB,MAIJ1D,EAAEQ,UAAUC,GAAG,QAAS,oBAAoB,WACxCL,eAAiB,KACjBJ,EAAE,4BAA4Bc"}