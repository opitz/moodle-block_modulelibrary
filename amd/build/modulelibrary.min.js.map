{"version":3,"file":"modulelibrary.min.js","sources":["../src/modulelibrary.js"],"sourcesContent":["/**\n * AMD module for block_modulelibrary\n * @module block_modulelibrary/modulelibrary\n */\ndefine(['jquery', 'core/ajax', 'core/notification'], function($, ajax, notification) {\n\n    /**\n     * Selected template module\n     * @type {{cmid: number, name: string}|null}\n     */\n    let selectedModule = null;\n\n    /** @type {number} Current course id */\n    let currentCourseId = 0;\n\n    /**\n     * Initializes the Module Library JS.\n     * @param {Object} opts\n     */\n    const init = function(opts) {\n        opts = opts || {};\n        currentCourseId = opts.currentCourseId || 0;\n        bindEvents();\n    };\n\n    /**\n     * Bind all events for the module library UI\n     */\n    function bindEvents() {\n        // When selecting a template course.\n        $(document).on('change', '#modulelibrary-course-select', function() {\n            const courseId = $(this).val();\n            if (courseId) {\n                loadTemplateCourseSections(courseId);\n            } else {\n                $('#modulelibrary-modules').empty();\n                $('#modulelibrary-copy-form').empty();\n            }\n        });\n\n        // When clicking \"Copy this module\".\n        $(document).on('click', '.select-template-module-btn', function() {\n            selectedModule = { cmid: $(this).data('cmid'), name: $(this).data('name') };\n            showCopyForm();\n        });\n\n        // Handle copy confirmation.\n        $(document).on('submit', '#copy-assessment-form', function(e) {\n            e.preventDefault();\n            doCopy();\n        });\n\n        // Cancel copy.\n        $(document).on('click', '#cancel-copy-btn', function() {\n            selectedModule = null;\n            $('#modulelibrary-copy-form').empty();\n        });\n    }\n\n    /**\n     * Load sections and modules from the template course.\n     * @param {number} courseId\n     */\n    function loadTemplateCourseSections(courseId) {\n        $('#modulelibrary-loading').show();\n        $('#modulelibrary-modules').empty();\n        $('#modulelibrary-copy-form').empty();\n\n        ajax.call([{\n            methodname: 'block_modulelibrary_get_template_course_modules',\n            args: { courseid: parseInt(courseId, 10) }\n        }])[0].done(function(response) {\n            $('#modulelibrary-loading').hide();\n            const data = response;\n            if (!data || !data.sections?.length) {\n                $('#modulelibrary-modules').html('<p>No modules found in this course.</p>');\n                return;\n            }\n            let html = '<h4>' + data.title + '</h4>';\n            data.sections.forEach(function(section) {\n                html += '<h5>Section ' + section.section + ' - ' + (section.name || '') + '</h5><ul>';\n                section.modules.forEach(function(m) {\n                    html += '<li>' + m.modname + ': ' + m.name +\n                        ' <button type=\"button\" class=\"select-template-module-btn\" data-cmid=\"' + m.cmid +\n                        '\" data-name=\"' + m.name + '\">Copy this module</button>' + '</li>';\n                });\n                html += '</ul>';\n            });\n            $('#modulelibrary-modules').html(html);\n        }).fail(function(err) {\n            $('#modulelibrary-loading').hide();\n            notification.exception(err);\n        });\n    }\n\n    /**\n     * Show copy form for selected template module\n     */\n    function showCopyForm() {\n        if (!selectedModule) {\n            return;\n        }\n\n        $('#modulelibrary-copy-form').html('<p>Loading target sections...</p>');\n\n        ajax.call([{\n            methodname: 'block_modulelibrary_get_target_course_sections',\n            args: { courseid: currentCourseId }\n        }])[0].done(function(sections) {\n            let html = '<div class=\"copy-form-container\">';\n            html += '<h6>Copy Template Module</h6>';\n            html += '<p><strong>' + selectedModule.name + '</strong></p>';\n            html += '<form id=\"copy-assessment-form\">';\n            html += '<label for=\"target-section\">Select target section:</label>';\n            html += '<select id=\"target-section\" required>';\n            html += '<option value=\"0\">Append at end</option>';\n            sections.forEach(function(sec) {\n                html += '<option value=\"' + sec.sectionnum + '\">' + sec.name + '</option>';\n            });\n            html += '</select>';\n            html += '<button type=\"submit\">Confirm copy</button>';\n            html += '<button type=\"button\" id=\"cancel-copy-btn\">Cancel</button>';\n            html += '</form></div>';\n            $('#modulelibrary-copy-form').html(html);\n        }).fail(function(err) {\n            $('#modulelibrary-copy-form').html('<p>Failed to load target sections</p>');\n            notification.exception(err);\n        });\n    }\n\n    /**\n     * Perform copy of selected template module\n     */\n    function doCopy() {\n        if (!selectedModule) {\n            notification.exception(new Error('No template module selected'));\n            return;\n        }\n        const targetsection = parseInt($('#target-section').val() || 0, 10);\n\n        ajax.call([{\n            methodname: 'block_modulelibrary_copy_activity',\n            args: {\n                cmid: parseInt(selectedModule.cmid, 10), // matches PHP external function param\n                targetcourseid: currentCourseId,\n                targetsection: targetsection\n            }\n        }])[0].done(function(response) {\n            if (response.status) {\n                notification.addNotification({message: 'Module copied successfully', type: 'success'});\n                setTimeout(function() { window.location.reload(); }, 1200);\n            } else {\n                notification.exception(new Error('Copy failed'));\n            }\n        }).fail(function(err) {\n            notification.exception(err);\n        });\n    }\n\n    return { init: init };\n});"],"names":["define","$","ajax","notification","selectedModule","currentCourseId","init","opts","document","on","courseId","this","val","show","empty","call","methodname","args","courseid","parseInt","done","response","hide","data","sections","_data$sections","length","html","title","forEach","section","name","modules","m","modname","cmid","fail","err","exception","loadTemplateCourseSections","sec","sectionnum","e","preventDefault","Error","targetsection","targetcourseid","status","addNotification","message","type","setTimeout","window","location","reload","doCopy"],"mappings":"AAIAA,2CAAO,CAAC,SAAU,YAAa,sBAAsB,SAASC,EAAGC,KAAMC,kBAM/DC,eAAiB,KAGjBC,gBAAkB,QAkJf,CAAEC,KA5II,SAASC,MAElBF,iBADAE,KAAOA,MAAQ,IACQF,iBAAmB,EAS1CJ,EAAEO,UAAUC,GAAG,SAAU,gCAAgC,iBAC/CC,SAAWT,EAAEU,MAAMC,MACrBF,kBA+BwBA,UAChCT,EAAE,0BAA0BY,OAC5BZ,EAAE,0BAA0Ba,QAC5Bb,EAAE,4BAA4Ba,QAE9BZ,KAAKa,KAAK,CAAC,CACPC,WAAY,kDACZC,KAAM,CAAEC,SAAUC,SAAST,SAAU,QACrC,GAAGU,MAAK,SAASC,6BACjBpB,EAAE,0BAA0BqB,aACtBC,KAAOF,aACRE,6BAASA,KAAKC,qCAALC,eAAeC,mBACzBzB,EAAE,0BAA0B0B,KAAK,+CAGjCA,KAAO,OAASJ,KAAKK,MAAQ,QACjCL,KAAKC,SAASK,SAAQ,SAASC,SAC3BH,MAAQ,eAAiBG,QAAQA,QAAU,OAASA,QAAQC,MAAQ,IAAM,YAC1ED,QAAQE,QAAQH,SAAQ,SAASI,GAC7BN,MAAQ,OAASM,EAAEC,QAAU,KAAOD,EAAEF,KAClC,wEAA0EE,EAAEE,KAC5E,gBAAkBF,EAAEF,KAFhB,sCAIZJ,MAAQ,WAEZ1B,EAAE,0BAA0B0B,KAAKA,SAClCS,MAAK,SAASC,KACbpC,EAAE,0BAA0BqB,OAC5BnB,aAAamC,UAAUD,QA1DnBE,CAA2B7B,WAE3BT,EAAE,0BAA0Ba,QAC5Bb,EAAE,4BAA4Ba,YAKtCb,EAAEO,UAAUC,GAAG,QAAS,+BAA+B,WACnDL,eAAiB,CAAE+B,KAAMlC,EAAEU,MAAMY,KAAK,QAASQ,KAAM9B,EAAEU,MAAMY,KAAK,SAyDjEnB,iBAILH,EAAE,4BAA4B0B,KAAK,qCAEnCzB,KAAKa,KAAK,CAAC,CACPC,WAAY,iDACZC,KAAM,CAAEC,SAAUb,oBAClB,GAAGe,MAAK,SAASI,cACbG,KAAO,oCACXA,MAAQ,gCACRA,MAAQ,cAAgBvB,eAAe2B,KAAO,gBAC9CJ,MAAQ,mCACRA,MAAQ,6DACRA,MAAQ,wCACRA,MAAQ,2CACRH,SAASK,SAAQ,SAASW,KACtBb,MAAQ,kBAAoBa,IAAIC,WAAa,KAAOD,IAAIT,KAAO,eAEnEJ,MAAQ,YACRA,MAAQ,8CACRA,MAAQ,6DACRA,MAAQ,gBACR1B,EAAE,4BAA4B0B,KAAKA,SACpCS,MAAK,SAASC,KACbpC,EAAE,4BAA4B0B,KAAK,yCACnCxB,aAAamC,UAAUD,YA/E3BpC,EAAEO,UAAUC,GAAG,SAAU,yBAAyB,SAASiC,GACvDA,EAAEC,gCAsFDvC,2BACDD,aAAamC,UAAU,IAAIM,MAAM,sCAG/BC,cAAgB1B,SAASlB,EAAE,mBAAmBW,OAAS,EAAG,IAEhEV,KAAKa,KAAK,CAAC,CACPC,WAAY,oCACZC,KAAM,CACFkB,KAAMhB,SAASf,eAAe+B,KAAM,IACpCW,eAAgBzC,gBAChBwC,cAAeA,kBAEnB,GAAGzB,MAAK,SAASC,UACbA,SAAS0B,QACT5C,aAAa6C,gBAAgB,CAACC,QAAS,6BAA8BC,KAAM,YAC3EC,YAAW,WAAaC,OAAOC,SAASC,WAAa,OAErDnD,aAAamC,UAAU,IAAIM,MAAM,mBAEtCR,MAAK,SAASC,KACblC,aAAamC,UAAUD,QA1GvBkB,MAIJtD,EAAEO,UAAUC,GAAG,QAAS,oBAAoB,WACxCL,eAAiB,KACjBH,EAAE,4BAA4Ba"}